<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Precision Crop Management</title>

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Leaflet Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>

<body>
<div class="container">
    <h2>ğŸŒ± Precision Crop Management System</h2>

    <!-- ERROR MESSAGE -->
    {% if error %}
        <div class="card" style="color:red;">{{ error }}</div>
    {% endif %}

    <!-- FORM -->
    <form action="/predict" method="post">
        <input type="number" name="area" placeholder="Farm Area (hectares)" step="any" required>

        <input type="number" name="N" placeholder="Nitrogen (N)" step="any" required>
        <input type="number" name="P" placeholder="Phosphorus (P)" step="any" required>
        <input type="number" name="K" placeholder="Potassium (K)" step="any" required>

        <input type="number" name="ph" placeholder="Soil pH" step="any" required>
        <input type="number" name="rainfall" placeholder="Rainfall (mm)" step="any" required>

        <button type="submit">Predict</button>
    </form>

    <!-- RESULTS -->
    {% if crop %}
        <div class="card">ğŸŒ¾ <b>Crop:</b> {{ crop }}</div>
        <div class="card">ğŸŒ¿ <b>Fertilizer:</b> {{ fertilizer }} ({{ fert_amount }} kg)</div>
        <div class="card">ğŸ’§ <b>Irrigation:</b> {{ irrigation }}</div>
        <div class="card">ğŸ“Š <b>Expected Yield:</b> {{ yield_estimate }} tons</div>

        <div class="card">
            ğŸŒ¦ <b>Weather:</b> {{ temperature }}Â°C | {{ humidity }}%
        </div>

        <!-- âœ… NEW: WEATHER MODE -->
        <div class="card">
            ğŸŒ <b>Weather Mode:</b> {{ weather_mode }}
        </div>

        <!-- NPK CHART -->
        <canvas id="npkChart"></canvas>

        <!-- SAFE DATA TRANSFER -->
        <script id="chart-data"
            data-npk='{{ [N, P, K] | tojson }}'>
        </script>

        <script>
            const el = document.getElementById("chart-data");
            const npk = JSON.parse(el.dataset.npk);

            new Chart(document.getElementById("npkChart"), {
                type: "bar",
                data: {
                    labels: ["Nitrogen", "Phosphorus", "Potassium"],
                    datasets: [{
                        label: "Soil Nutrient Levels",
                        data: npk,
                        backgroundColor: ["#66bb6a", "#ffa726", "#42a5f5"]
                    }]
                }
            });
        </script>
    {% endif %}
</div>
</body>
</html>
